#!/bin/bash

OPTIND=1

ShowHelp(){
    echo -e "\nFor (Each Repo) Do ..."
    echo -e "Usage:"
    echo -e "jgforeachrepodo <command> [<command-argument> ...]\n"
    echo -e "Execute <command> for each repo in current folder."
    echo -e "Won't execute for the repo without .git folder."
    echo -e "Won't execute for the repo whose name contains spaces."
    echo -e "\nExample:\n"
    echo -e "jgforeachrepodo git pull"
    exit 0
}

while getopts "h?" opt; do
    case "$opt" in
        h|\?)
            ShowHelp;;
    esac
done

shift $((OPTIND-1))

[[ "${1:-}" = "--" ]] && shift

[[ $# -eq 0 ]] && ShowHelp

for repo in `ls`
do
    ! [[ -d $repo/.git ]] && {
        echo -e "\n[101;93mOmit $repo[0m\n"
        continue
    }
    pushd $repo > /dev/null
    echo -e "\n[93m$repo[0m"
    $@
    popd > /dev/null
done
exit 0
