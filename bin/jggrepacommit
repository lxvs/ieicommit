#!/bin/bash

OPTIND=1

while getopts "h?" opt; do
    case "$opt" in
        h|\?)
            echo -e "\nGrep a commit"
            echo -e "Usage:"
            echo -e "jggrepacommit [<option>] <pattern>\n"
            echo -e "Search for commits that meet the given regex pattern, and copy the first found commit number."
            echo -e "N.B. '\\' itself needs another '\\' to be escaped in Bash."
            echo -e "E.g. if searching for '[', pattern '\\\\[' should be used."
            echo -e "\nOptions are same with 'grep'."
            echo -e "Try 'grep --help' for more information."
            exit 0
            ;;
    esac
done

shift $((OPTIND-1))

[[ "${1:-}" = "--" ]] && shift

if [ $# -eq 0 ]; then
    echo "Error: no pattern provided."
    exit 1
else
    oput=`git log --pretty=format:"%h %an %s" | grep "$@"`
    if [ -n "${oput}" ]; then
        echo "${oput}"
        echo -n "${oput:0:7}" | clip
        echo -e "\n> ${oput:0:7} has been copied to clipboard."
    else
        echo -e "Nothing was found using given pattern."
        exit 2
    fi
fi
