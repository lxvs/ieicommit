#!/bin/bash

OPTIND=1

while getopts "h?" opt; do
    case "$opt" in
        h|\?)
            echo -e "\nCommit number"
            echo -e "Usage:"
            echo -e "jgcommitnumber [<n>]\n"
            echo -e "Display and copy the first <n> digits of commit number."
            echo -e "<n> ranges from 1 to 40, default 8."
            exit 0
            ;;
    esac
done

shift $((OPTIND-1))

[[ "${1:-}" = "--" ]] && shift

fullhash=`git log -1 --format="%H"`
length=${1:-8}
if ! [[ $length =~ ^[0-9]+$ ]]; then
    echo -e "Invalid argument: not a integer."
    exit 1
fi
cliped=${fullhash: 0: $length}
git log -1 --abbrev=$length --format="%h %s"
echo -n "${cliped}" | clip
